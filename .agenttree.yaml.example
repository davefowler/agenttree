# AgentTree Configuration Example
# Copy to .agenttree.yaml in your project root
# For a complete working config, use: agenttree init
#
# This is a simplified example showing the key patterns. The full template
# generated by `agenttree init` includes all stages and advanced features.

# ============================================================================
# Project Settings
# ============================================================================

# Project name (used for tmux session naming and container naming)
project: myapp

# Default AI tool to use when not specified
default_tool: claude

# Default model for AI agents
default_model: opus

# Port range for agents (manager gets first port, issues get the rest)
# Issue #1 gets 9001, #42 gets 9042, etc. High numbers wrap around.
port_range: 9000-9100

# Directory where agent worktrees are created
worktrees_dir: .worktrees

# ============================================================================
# Commands
# ============================================================================
# Shell commands available to the workflow. Used by hooks like `run:`.

commands:
  test: pytest
  lint: "mypy myapp || echo 'Lint warnings'"

# ============================================================================
# Tools
# ============================================================================
# AI CLI tools that agents use. Each tool needs a command and startup prompt.

tools:
  claude:
    command: claude
    skip_permissions: true  # Add --dangerously-skip-permissions flag
    startup_prompt: "Run 'agenttree next' for your current stage instructions."
  aider:
    command: aider
    startup_prompt: "Run 'agenttree next' for your current stage instructions."

# ============================================================================
# Roles
# ============================================================================
# Roles define who handles stages. Built-in roles: manager, developer.
# Add custom roles for specialized agents (e.g., reviewer).

roles:
  reviewer:
    description: "Independent code reviewer"
    container:
      image: agenttree-agent:latest
    tool: claude
    model: sonnet
    skill: independent_review.md

# ============================================================================
# Flows
# ============================================================================
# Flows define the sequence of stages an issue goes through.
# The default flow defines stages inline. Secondary flows reference stages.

flows:
  default:
    stages:
      # Parking lot stages (no agent auto-starts)
      backlog:
        is_parking_lot: true

      # Exploration phase
      explore:
        color: "#f97316"  # Orange
        substages:
          define:
            output: problem.md
            pre_completion:
              - title_set:
              - section_check:
                  file: problem.md
                  section: Context
                  expect: not_empty

          research:
            output: research.md
            post_start:
              - create_file:
                  template: research.md
                  dest: research.md

      # Implementation phase
      implement:
        color: "#22c55e"  # Green
        substages:
          setup: {}
          code: {}
          review:
            human_review: true  # Requires human approval to exit
            review_doc: review.md

      # Terminal stage
      accepted:
        is_parking_lot: true
        color: "#6b7280"  # Gray
        role: manager
        post_start:
          - merge_pr:
          - cleanup_agent:

  # Secondary flow using references (stage names expand to their substages)
  quick:
    stages:
      - backlog
      - explore.define
      - implement
      - accepted

default_flow: default
