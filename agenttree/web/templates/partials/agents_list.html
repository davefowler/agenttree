{% for agent in agents %}
<div class="agent-card">
    <div class="agent-header">
        <div class="agent-title">Agent {{ agent.agent_num }}</div>
        <span class="status-badge {% if agent.status == 'working' %}status-working{% elif agent.status == 'error' %}status-error{% else %}status-idle{% endif %}">
            {{ agent.status }}
        </span>
    </div>

    <div class="agent-info">
        <div class="info-row">
            <span class="info-label">Current Task:</span>
            <span class="info-value">{{ agent.current_task or "None" }}</span>
        </div>
        <div class="info-row">
            <span class="info-label">Tmux Active:</span>
            <span class="info-value">{{ "✓" if agent.tmux_active else "✗" }}</span>
        </div>
        <div class="info-row">
            <span class="info-label">Last Activity:</span>
            <span class="info-value">{{ agent.last_activity }}</span>
        </div>
    </div>

    <h3 class="collapsible" style="font-size: 14px; margin-top: 15px; padding: 10px 0;">
        Tmux Output
    </h3>
    <div class="collapsible-content">
        <div class="tmux-container"
             hx-get="/agent/{{ agent.agent_num }}/tmux"
             hx-trigger="load, every 2s"
             hx-swap="innerHTML">
            <div class="tmux-output">Loading tmux output...</div>
        </div>

        <div class="input-group">
            <input type="text"
                   id="message-{{ agent.agent_num }}"
                   name="message"
                   placeholder="Send command to agent...">
            <button class="btn btn-primary"
                    hx-post="/agent/{{ agent.agent_num }}/send"
                    hx-include="#message-{{ agent.agent_num }}"
                    hx-target="#send-status-{{ agent.agent_num }}">
                Send
            </button>
        </div>
        <div id="send-status-{{ agent.agent_num }}"></div>
    </div>

    <h3 class="collapsible collapsed" style="font-size: 14px; margin-top: 15px; padding: 10px 0;">
        Dispatch Task
    </h3>
    <div class="collapsible-content hidden">
        <form hx-post="/agent/{{ agent.agent_num }}/dispatch"
              hx-target="#dispatch-status-{{ agent.agent_num }}">
            <div style="margin-bottom: 10px;">
                <input type="number"
                       name="issue_number"
                       placeholder="GitHub Issue # (optional)"
                       style="width: 100%;">
            </div>
            <div style="margin-bottom: 10px;">
                <textarea name="task_description"
                          placeholder="Or enter ad-hoc task description..."></textarea>
            </div>
            <button type="submit" class="btn btn-primary">Dispatch Task</button>
        </form>
        <div id="dispatch-status-{{ agent.agent_num }}" style="margin-top: 10px;"></div>
    </div>
</div>
{% endfor %}
