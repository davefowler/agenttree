<!-- Flow-specific issue detail with file tabs -->
<div data-issue-id="{{ issue.number }}" data-agent-num="{{ issue.assigned_agent or '' }}">
    <!-- Issue header -->
    <div class="issue-detail" style="padding: 20px; border-bottom: 1px solid #d4d0c4;">
        <div class="detail-header" style="margin-bottom: 0; padding-bottom: 0; border-bottom: none;">
            <div class="detail-title">
                #{{ issue.number }}: {{ issue.title }}
            </div>
            <div class="detail-meta">
                <span>Stage: {{ issue.stage.value.replace('_', ' ').title() }}</span>
                {% if issue.assigned_agent %}
                <span>Agent: {{ issue.assigned_agent }}</span>
                {% endif %}
            </div>
        </div>
        <div class="detail-actions" style="margin-top: 15px;">
            <button class="btn btn-primary"
                    hx-post="/api/issues/{{ issue.number }}/start"
                    hx-target="#dispatch-status-{{ issue.number }}"
                    hx-swap="innerHTML">
                Start Agent
            </button>
            <span id="dispatch-status-{{ issue.number }}"></span>
        </div>
    </div>

    <!-- File tabs -->
    <div class="file-tabs-container">
        <div class="file-tabs" id="file-tabs">
            {% for file in files %}
            <button class="file-tab{% if loop.first %} active{% endif %}"
                    onclick="selectFileTab('{{ issue.number }}', '{{ file.name }}')">
                {{ file.display_name }}
            </button>
            {% else %}
            <span style="padding: 10px 16px; color: #6b8f7a; font-size: 13px;">No files found</span>
            {% endfor %}
        </div>
    </div>

    <!-- File content -->
    <div class="issue-content" id="file-content">
        {% if issue.body %}
        <div class="markdown-content">
            <div class="markdown-rendered" id="markdown-display"></div>
            <script type="text/template" id="markdown-source">{{ issue.body }}</script>
            <script>
                (function() {
                    const source = document.getElementById('markdown-source').textContent;
                    const display = document.getElementById('markdown-display');
                    if (typeof marked !== 'undefined') {
                        display.innerHTML = marked.parse(source);
                    } else {
                        display.innerHTML = '<pre class="markdown-raw">' + source + '</pre>';
                    }
                })();
            </script>
        </div>
        {% else %}
        <div class="empty-state">
            <p>No content available</p>
        </div>
        {% endif %}
    </div>
</div>
