<!-- Kanban board columns - polled for updates -->
{% for stage in stages %}
<div class="kanban-column" data-stage="{{ stage.value }}">
    <div class="column-header">
        <span>{{ stage.value.replace('_', ' ').title() }}</span>
        <span class="column-count">{{ board.stages[stage]|length }}</span>
    </div>
    <div class="column-cards">
        {% for issue in board.stages[stage] %}
        <div class="kanban-card"
             data-issue="{{ issue.number }}"
             data-stage="{{ issue.stage.value }}"
             data-has-agent="{{ 'true' if issue.assigned_agent else 'false' }}"
             draggable="{{ 'true' if issue.stage.value in ['plan_review', 'implementation_review'] else 'false' }}"
             hx-get="/kanban?issue={{ issue.number }}"
             hx-push-url="true"
             hx-target="body"
             hx-swap="outerHTML">
            <div class="agent-light {% if issue.tmux_active %}on{% elif issue.assigned_agent %}stalled{% else %}off{% endif %}"
                 onclick="event.stopPropagation(); toggleAgent('{{ issue.number }}', this)"
                 title="{% if issue.tmux_active %}Agent running - click to view{% elif issue.assigned_agent %}Agent assigned but inactive{% else %}Click to start agent{% endif %}"></div>
            <div class="card-number">#{{ issue.number }}</div>
            <div class="card-title">{{ issue.title }}</div>
            <div class="card-badges">
                {% for label in issue.labels[:2] %}
                {% if not label.startswith('stage-') %}
                <span class="badge">{{ label }}</span>
                {% endif %}
                {% endfor %}
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endfor %}

<!-- Mini dropzones for hidden columns -->
<div class="mini-dropzones" id="mini-dropzones">
    <div class="mini-dropzone" data-stage="accepted" id="mini-accepted">
        <span class="dropzone-label">Accepted</span>
        <span class="dropzone-count" id="accepted-count">0</span>
    </div>
    <div class="mini-dropzone" data-stage="not_doing" id="mini-not-doing">
        <span class="dropzone-label">Not Doing</span>
        <span class="dropzone-count" id="not-doing-count">0</span>
    </div>
</div>
